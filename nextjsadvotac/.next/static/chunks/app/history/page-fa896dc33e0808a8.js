(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3429],{63:(e,s,a)=>{"use strict";var t=a(7260);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}}),a.o(t,"useSearchParams")&&a.d(s,{useSearchParams:function(){return t.useSearchParams}})},1840:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>h});var t,i=a(5155),l=a(63),r=a(2115);a(2620);let n=null!=(t=a(5704).env.NEXT_PUBLIC_FASTAPI_BASE_URL)?t:"https://api.advotac.com";function h(){let e=(0,l.useRouter)(),[s,a]=(0,r.useState)(null),[t,h]=(0,r.useState)(!0),[o,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[x,v]=(0,r.useState)(null),m=(0,r.useCallback)(async(e,s,a)=>{u(!0),v(null);try{let t=new URLSearchParams;s&&t.append("user_id",s),a&&t.append("user_email",a),t.append("limit","50");let i=await fetch("".concat(n,"/api/assistant/history?").concat(t.toString()),{headers:{"Content-Type":"application/json",...e?{Authorization:"Bearer ".concat(e)}:{}}});if(404===i.status){c([]),v("No assistant history found for this account yet. Ask a question to see it here.");return}if(!i.ok){let e=await i.json().catch(()=>null),s=e&&"object"==typeof e&&"detail"in e?e.detail:"Failed to load assistant history";throw Error(s)}let l=await i.json();c(l)}catch(e){console.error("[HISTORY] Failed to fetch history:",e),c([]),v(e instanceof Error?e.message:"Failed to load assistant history")}finally{u(!1)}},[]);(0,r.useEffect)(()=>{(async()=>{let s=localStorage.getItem("authToken"),t=localStorage.getItem("userData");if(!s||!t)return e.push("/auth");try{let e=JSON.parse(t),i=e.id||e.email;if(!i||!e.email||!e.name)throw Error("Missing user profile data");let l={id:i,name:e.name,email:e.email,image:e.image};a(l),h(!1),await m(s,i,e.email)}catch(s){console.error("[HISTORY] Failed to initialise user session:",s),localStorage.clear(),e.push("/auth")}})()},[m,e]);let j=async()=>{let a=localStorage.getItem("authToken");if(!a||!s)return void e.push("/auth");await m(a,s.id,s.email)};return t?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:"#f7f9fc"},children:(0,i.jsx)("div",{style:{textAlign:"center"},children:(0,i.jsx)("div",{style:{fontSize:"24px",marginBottom:"16px",color:"#0E8587"},children:"Loading..."})})}):(0,i.jsxs)("div",{className:"dashboard-container",children:[(0,i.jsxs)("aside",{className:"sidebar",children:[(0,i.jsx)("div",{className:"sidebar-header",children:(0,i.jsxs)("div",{className:"logo",children:[(0,i.jsx)("img",{src:"/advotac_logo.png",alt:"Advotac Logo",className:"logo-image"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{children:"Advotac"}),(0,i.jsx)("p",{children:"Legal AI Workspace"})]})]})}),(0,i.jsxs)("nav",{className:"sidebar-nav",children:[(0,i.jsxs)("a",{href:"/dashboard",className:"nav-item",children:[(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})}),"Overview"]}),(0,i.jsxs)("a",{href:"/assistant",className:"nav-item",children:[(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,i.jsx)("path",{d:"M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"}),(0,i.jsx)("path",{d:"M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"})]}),"Assistant"]}),(0,i.jsxs)("a",{href:"/research",className:"nav-item",children:[(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{d:"M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"})}),"Research"]}),(0,i.jsxs)("a",{href:"/drafting",className:"nav-item",children:[(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})}),"Drafting"]}),(0,i.jsxs)("a",{href:"/workflow",className:"nav-item",children:[(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),"Workflow"]}),(0,i.jsxs)("a",{href:"/history",className:"nav-item active",children:[(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),"History"]})]}),(0,i.jsxs)("div",{className:"sidebar-footer",children:[(0,i.jsxs)("a",{href:"/settings",className:"nav-item",children:[(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})}),"Settings"]}),(0,i.jsxs)("button",{onClick:()=>{localStorage.clear(),window.location.replace("/auth")},className:"nav-item logout-btn",children:[(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z",clipRule:"evenodd"})}),"Logout"]})]})]}),(0,i.jsxs)("main",{className:"main-content",children:[(0,i.jsxs)("header",{className:"dashboard-header",children:[(0,i.jsx)("h1",{children:"History"}),(0,i.jsxs)("div",{className:"header-actions",children:[(0,i.jsxs)("div",{className:"search-box",children:[(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})}),(0,i.jsx)("input",{type:"text",placeholder:"Search history...",disabled:!0})]}),(0,i.jsx)("button",{className:"icon-button",onClick:j,title:"Refresh history",children:(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{d:"M4 4v4h.01L4 4zm12.243.757A8 8 0 104.757 15.243l1.414-1.414A6 6 0 1116 10h-3l4 4 4-4h-3a8 8 0 00-1.757-5.243z"})})}),(0,i.jsx)("button",{className:"icon-button profile-button",onClick:()=>window.location.href="/settings",title:"Go to Settings",children:(null==s?void 0:s.image)?(0,i.jsx)("img",{src:s.image,alt:s.name,className:"user-avatar-small"}):(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})})]})]}),(0,i.jsx)("div",{className:"history-content",children:d?(0,i.jsxs)("div",{className:"history-loading",children:[(0,i.jsx)("div",{className:"spinner"}),(0,i.jsx)("p",{children:"Fetching assistant historyâ€¦"})]}):x?(0,i.jsxs)("div",{className:"history-error",children:[(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),(0,i.jsx)("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),(0,i.jsx)("p",{children:x})]}):0===o.length?(0,i.jsxs)("div",{className:"history-empty",children:[(0,i.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"#0E8587",strokeWidth:"1.5",children:[(0,i.jsx)("path",{d:"M5 4h14a2 2 0 012 2v10l-4 4H5a2 2 0 01-2-2V6a2 2 0 012-2z"}),(0,i.jsx)("path",{d:"M15 2v4"}),(0,i.jsx)("path",{d:"M9 2v4"}),(0,i.jsx)("path",{d:"M3 10h18"})]}),(0,i.jsx)("h2",{children:"No history yet"}),(0,i.jsx)("p",{children:"Run your first assistant query to see it logged here automatically."}),(0,i.jsx)("button",{className:"primary-button",onClick:()=>e.push("/assistant"),children:"Ask a question"})]}):(0,i.jsx)("div",{className:"history-table-wrapper",children:(0,i.jsxs)("table",{className:"history-table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Created"}),(0,i.jsx)("th",{children:"Task"}),(0,i.jsx)("th",{children:"Question"}),(0,i.jsx)("th",{children:"Answer"}),(0,i.jsx)("th",{children:"Response Time"}),(0,i.jsx)("th",{children:"View"})]})}),(0,i.jsx)("tbody",{children:o.map(s=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:function(e){try{return new Date(e).toLocaleString(void 0,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(s){return e}}(s.created_at)}),(0,i.jsx)("td",{children:(0,i.jsx)("span",{className:"history-task",children:s.task_name})}),(0,i.jsx)("td",{children:(0,i.jsx)("div",{className:"history-question",children:s.question})}),(0,i.jsx)("td",{children:(0,i.jsxs)("details",{className:"history-answer-details",children:[(0,i.jsx)("summary",{children:function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:140;if(!e)return"";let a=e.replace(/\s+/g," ").trim();return a.length<=s?a:"".concat(a.slice(0,s),"â€¦")}(s.answer)}),(0,i.jsx)("pre",{className:"history-answer-full",children:s.answer})]})}),(0,i.jsx)("td",{children:"analysis"===s.entry_type&&null!=s.response_time_ms?"".concat(s.response_time_ms," ms"):"â€”"}),(0,i.jsx)("td",{children:"general"===s.entry_type&&s.token?(0,i.jsx)("button",{type:"button",className:"history-view-button",onClick:()=>e.push("/assistant/task/".concat(s.token)),children:"Open"}):"â€”"})]},s.id))})]})})})]})]})}},2620:()=>{},4307:(e,s,a)=>{Promise.resolve().then(a.bind(a,1840))}},e=>{e.O(0,[2787,8441,1255,7358],()=>e(e.s=4307)),_N_E=e.O()}]);