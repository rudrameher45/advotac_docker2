(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4426],{63:(e,t,s)=>{"use strict";var a=s(7260);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},4426:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var a,r=s(5155),n=s(2115),l=s(63);s(8151);var o=s(5704);let i=[e=>'Summarize the key legal principles around "'.concat(e,'".'),e=>'What statutory provisions are most relevant to "'.concat(e,'"?'),e=>'Are there landmark cases interpreting "'.concat(e,'"?'),e=>'How does "'.concat(e,'" affect compliance obligations?')],c=null!=(a=o.env.NEXT_PUBLIC_FASTAPI_BASE_URL)?a:"https://api.advotac.com",d="".concat(c,"/api/assistant/general-history");function u(e){let{answer:t}=e;return(0,r.jsx)("div",{className:"formatted-answer",children:(e=>{let t=e.replace(/\*\*\*\*/g,"").replace(/\*\*/g,"").replace(/---/g,"\n").trim(),s=[],a=t.split(/\n+/),n=[],l=0;return a.forEach(e=>{let t=e.trim();t&&(t.match(/^[A-Z\s&/]+:/)||t.match(/^Section \d+/i)?(n.length>0&&(s.push((0,r.jsx)("div",{className:"answer-paragraph",children:n.join(" ")},l++)),n=[]),s.push((0,r.jsx)("h3",{className:"answer-heading",children:t},"h-".concat(l++)))):t.match(/^[\d\-\(]+[\)\.]?\s/)||t.startsWith("-")?(n.length>0&&(s.push((0,r.jsx)("div",{className:"answer-paragraph",children:n.join(" ")},l++)),n=[]),s.push((0,r.jsx)("div",{className:"answer-list-item",children:t},"li-".concat(l++)))):n.push(t))}),n.length>0&&s.push((0,r.jsx)("div",{className:"answer-paragraph",children:n.join(" ")},l++)),s.length>0?s:(0,r.jsx)("div",{className:"answer-paragraph",children:t})})(t)})}function h(){var e,t;let s=(0,l.useRouter)(),a=(0,l.useParams)().token,[o,h]=(0,n.useState)(null),[p,g]=(0,n.useState)(!0),[m,x]=(0,n.useState)(!0),[v,y]=(0,n.useState)(null),[f,j]=(0,n.useState)(null),[w,b]=(0,n.useState)(null),[S,N]=(0,n.useState)([]),[k,A]=(0,n.useState)({}),[T,_]=(0,n.useState)(!1),[F,C]=(0,n.useState)(!1),[E,L]=(0,n.useState)(null),[P,q]=(0,n.useState)({}),[z,U]=(0,n.useState)([]),[D,R]=(0,n.useState)(""),[I,O]=(0,n.useState)(null),M=()=>"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"fu-".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2)),B=S.some(e=>e.isLoading),W=z.some(e=>e.isLoading),G=Object.values(k),H=G.length,V=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),J=(e,t)=>{if(!e||"object"!=typeof e||null===e)return null;let s="string"==typeof e.token?e.token:t,a="string"==typeof e.task?e.task:"Analysis Docs",r="string"==typeof e.query?e.query:"",n="string"==typeof e.summary?e.summary:"",l="string"==typeof e.analysis?e.analysis:n||("number"==typeof e.analysis?String(e.analysis):""),o=Array.isArray(e.key_points)?e.key_points.filter(e=>"string"==typeof e&&e.trim().length>0):[],i=Array.isArray(e.keywords)?e.keywords.filter(e=>"string"==typeof e&&e.trim().length>0):[];return{token:s,task:a,query:r,summary:n,analysis:l,key_points:o,keywords:i,comparisons:Array.isArray(e.comparisons)?e.comparisons.filter(e=>"string"==typeof e&&e.trim().length>0):[],table_markdown:"string"==typeof e.table_markdown&&e.table_markdown.trim().length>0?e.table_markdown:null,truncated:!!e.truncated,input_characters:"number"==typeof e.input_characters?e.input_characters:0,source:"string"==typeof e.source?e.source:"text",created_at:"string"==typeof e.created_at?e.created_at:new Date().toISOString()}},K=(e,t)=>{let s=e=>{var t,s;return null!=(s=null==(t=e.toLowerCase().match(/\b[a-z0-9]{3,}\b/g))?void 0:t.filter(Boolean))?s:[]},a=s(t);if(0===a.length)return!0;let r=s(e);return 0!==r.length&&r.some(e=>a.includes(e))};(0,n.useEffect)(()=>{if(!a.startsWith("gen-")||!f)return void q(e=>Object.keys(e).length>0?{}:e);q(e=>{let t=[f.token,...S.map(e=>e.id)],s={},a=!1;return t.forEach(t=>{e[t]?s[t]=e[t]:(s[t]={value:"",error:null},a=!0)}),Object.keys(e).length!==t.length&&(a=!0),a?s:e})},[S,f,a]),(0,n.useEffect)(()=>{if(!v||!a.startsWith("ana-")){U([]),R(""),O(null);return}U([]),R(""),O(null)},[null==v?void 0:v.token,a]),(0,n.useEffect)(()=>{let e=localStorage.getItem("authToken"),t=localStorage.getItem("userData");if(!e||!t)return void s.push("/auth");try{let e=JSON.parse(t);h(e),g(!1)}catch(e){console.error("[ASSISTANT RESULT] Failed to parse user data:",e),localStorage.clear(),s.push("/auth")}},[s]),(0,n.useEffect)(()=>{if(!p&&a&&o){if(b(null),A({}),q({}),L(null),a.startsWith("gen-")){if(x(!0),j(null),y(null),N([]),(()=>{try{let e=sessionStorage.getItem("assistantTask:".concat(a));if(e){let t=JSON.parse(e),s=null,r=[];if(t&&"object"==typeof t&&"general"in t&&t.general?(s=t.general,Array.isArray(t.followUps)&&(r=t.followUps)):t&&"object"==typeof t&&"general"===t.type&&(s=t),s&&s.token===a)return j(s),r.length>0&&N(r.map(e=>({id:e.id,query:e.query,created_at:e.created_at,response:e.response,isLoading:!1,error:null}))),x(!1),!0}}catch(e){console.warn("[ASSISTANT RESULT] Failed to read general result:",e)}return!1})())return;(async()=>{try{var e,t,s,r,n,l,i,c,u,h,p,g,m;let v=new URLSearchParams;o.id&&v.append("user_id",o.id),o.email&&v.append("user_email",o.email);let y=localStorage.getItem("authToken"),f=v.toString(),w=f?"".concat(d,"/").concat(a,"?").concat(f):"".concat(d,"/").concat(a),b=await fetch(w,{headers:{...y?{Authorization:"Bearer ".concat(y)}:{}}});if(!b.ok){let e=await b.json().catch(()=>null),t=e&&"object"==typeof e&&"detail"in e?e.detail:"Unable to load the saved response for this task.";throw Error(t)}let S=await b.json();if(!S||"object"!=typeof S)throw Error("Received malformed general task response.");let N={type:"general",token:null!=(l=S.token)?l:a,task:null!=(i=S.task_name)?i:"General",query:null!=(c=S.query)?c:"",created_at:null!=(u=S.created_at)?u:new Date().toISOString(),response:{query:null!=(p=null!=(h=null==(e=S.response)?void 0:e.query)?h:S.query)?p:"",answer:null!=(g=null==(t=S.response)?void 0:t.answer)?g:"",expanded_queries:Array.isArray(null==(s=S.response)?void 0:s.expanded_queries)?S.response.expanded_queries:[],sources:Array.isArray(null==(r=S.response)?void 0:r.sources)?S.response.sources:[],validation:null!=(m=null==(n=S.response)?void 0:n.validation)?m:null}};j(N),x(!1);try{sessionStorage.setItem("assistantTask:".concat(a),JSON.stringify({general:N,followUps:[]}))}catch(e){console.warn("[ASSISTANT RESULT] Failed to cache general result:",e)}}catch(e){console.error("[ASSISTANT RESULT] General fetch failed:",e),b(e instanceof Error?e.message:"Unable to load the saved response for this task."),x(!1)}})();return}j(null),y(null),x(!0),(()=>{try{let e=sessionStorage.getItem("analysisTask:".concat(a));if(e){let t=JSON.parse(e),s=J(t,a);if(s&&s.token===a)return y(s),x(!1),!0}}catch(e){console.warn("[ASSISTANT RESULT] Failed to read analysis result:",e)}try{let e=sessionStorage.getItem("latestAnalysis");if(e){let t=JSON.parse(e),s=J(t,a);if(s&&s.token===a)return y(s),x(!1),!0}}catch(e){console.warn("[ASSISTANT RESULT] Failed to read cached analysis:",e)}return!1})()||(x(!1),b("Unable to locate the saved analysis result for this task."))}},[p,a,o]),(0,n.useEffect)(()=>{if(!f||!a.startsWith("gen-"))return;let e=S.filter(e=>e.response&&!e.isLoading&&!e.error).map(e=>({id:e.id,query:e.query,created_at:e.created_at,response:e.response}));try{sessionStorage.setItem("assistantTask:".concat(a),JSON.stringify({general:f,followUps:e}))}catch(e){console.warn("[ASSISTANT RESULT] Failed to persist session state:",e)}},[S,f,a]);let Q=async e=>{var t,s,a,r;let n=e.trim();if(!n)return;if(!f)return void alert("Please wait for the task result to load before requesting follow-ups.");if(T||F)return;if(!o)return void alert("Please sign in to continue.");if(S.some(e=>e.query.toLowerCase()===n.toLowerCase()&&e.isLoading))return;let l=o.id||o.email||null;if(!l||!o.email)return void alert("Unable to identify the current user. Please sign in again.");let i=M(),d=new Date().toISOString(),u=null!=(t=f.task)?t:"General";N(e=>[...e,{id:i,query:n,created_at:d,response:null,isLoading:!0,error:null}]);try{let e=await fetch("".concat(c,"/api/assistant/query-v2"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n,top_k:5,threshold:.7,validate:!0,task_name:u,user_id:l,user_email:o.email})}),t=await e.text(),h=null;if(t)try{h=JSON.parse(t)}catch(e){h=null}if(!e.ok){let e=h&&"object"==typeof h&&"detail"in h?h.detail:(null==t?void 0:t.trim())||void 0;throw Error(null!=e?e:"Unable to generate a follow-up answer.")}let p=null!=h?h:{},g={query:null!=(s=p.query)?s:n,answer:null!=(a=p.answer)?a:"",expanded_queries:Array.isArray(p.expanded_queries)?p.expanded_queries:[],sources:Array.isArray(p.sources)?p.sources:[],validation:null!=(r=p.validation)?r:null};N(e=>e.map(e=>e.id===i?{...e,response:g,isLoading:!1,error:null}:e)),es(i,n,g,d)}catch(t){console.error("[ASSISTANT RESULT] Follow-up generation failed:",t);let e=t instanceof Error?t.message:"Unable to generate the follow-up answer.";N(t=>t.map(t=>t.id===i?{...t,isLoading:!1,error:e}:t))}},Y=async e=>{let t=e.trim();if(!t||T||F)return;if(!o)return void alert("Please sign in to continue.");if(!v)return void O("Analysis result is unavailable. Please reload the task.");if(z.some(e=>e.query.toLowerCase()===t.toLowerCase()&&e.isLoading))return;let s=o.id||o.email||null;if(!s||!o.email)return void alert("Unable to identify the current user. Please sign in again.");let a=M(),r=new Date().toISOString();U(e=>[...e,{id:a,query:t,created_at:r,response:null,isLoading:!0,error:null}]);try{var n,l,i;let e=await fetch("".concat(c,"/api/assistant/query-v2"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,top_k:5,threshold:.7,validate:!0,task_name:"Analysis Docs Follow-up",user_id:s,user_email:o.email})}),r=await e.text(),d=null;if(r)try{d=JSON.parse(r)}catch(e){d=null}if(!e.ok){let e=d&&"object"==typeof d&&"detail"in d?d.detail:(null==r?void 0:r.trim())||void 0;throw Error(null!=e?e:"Unable to generate an analysis follow-up answer.")}let u=null!=d?d:{},h={query:null!=(n=u.query)?n:t,answer:null!=(l=u.answer)?l:"",expanded_queries:Array.isArray(u.expanded_queries)?u.expanded_queries:[],sources:Array.isArray(u.sources)?u.sources:[],validation:null!=(i=u.validation)?i:null};U(e=>e.map(e=>e.id===a?{...e,response:h,isLoading:!1,error:null}:e)),O(null)}catch(t){console.error("[ASSISTANT RESULT] Analysis follow-up failed:",t);let e=t instanceof Error?t.message:"Unable to generate the follow-up answer.";U(t=>t.map(t=>t.id===a?{...t,isLoading:!1,error:e}:t)),O(e)}},X=async()=>{try{if(f){await navigator.clipboard.writeText(f.response.answer),alert("Answer copied to clipboard.");return}if(!v)return;await navigator.clipboard.writeText((e=>{let t=[];return t.push("Task: ".concat(e.task)),t.push("Original Query: ".concat(e.query)),t.push("Source: ".concat(e.source)),t.push(""),t.push("Summary:"),t.push(e.summary||"No summary generated."),t.push(""),t.push("Detailed Analysis:"),t.push(e.analysis||"No detailed analysis available."),t.push(""),e.key_points.length>0&&(t.push("Key Points:"),e.key_points.forEach((e,s)=>{t.push("".concat(s+1,". ").concat(e))}),t.push("")),e.keywords.length>0&&(t.push("Keywords: ".concat(e.keywords.join(", "))),t.push("")),e.comparisons.length>0&&(t.push("Comparative Insights:"),e.comparisons.forEach((e,s)=>{t.push("".concat(s+1,". ").concat(e))}),t.push("")),e.table_markdown&&(t.push("Structured Comparison Table (Markdown):"),t.push(e.table_markdown),t.push("")),t.push("Input characters analyzed: ".concat(e.input_characters)),e.truncated&&t.push("Note: Input was truncated to fit the token budget."),t.join("\n")})(v)),alert("Analysis copied to clipboard.")}catch(e){console.error("[ASSISTANT RESULT] Copy failed:",e),alert("Unable to copy content. Please copy manually.")}},Z=(e,t,s)=>{if(!s)return void alert("Answer is still generating. Please try again once it is ready.");A(a=>{let r={...a};return r[e]?delete r[e]:r[e]={id:e,question:t,response:s},r}),L(null)},$=async()=>{var e;let t=window;if(null==(e=t.jspdf)?void 0:e.jsPDF)return t.jspdf.jsPDF;if(t.jsPDF)return t.jsPDF;let s=document.getElementById("jspdf-script");return new Promise(s?(e,a)=>{s.addEventListener("load",()=>{var s;let r=(null==(s=t.jspdf)?void 0:s.jsPDF)||t.jsPDF;r?e(r):a(Error("PDF generator unavailable."))}),s.addEventListener("error",()=>a(Error("Failed to load PDF script.")))}:(e,s)=>{let a=document.createElement("script");a.id="jspdf-script",a.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",a.async=!0,a.onload=()=>{var a;let r=(null==(a=t.jspdf)?void 0:a.jsPDF)||t.jsPDF;r?e(r):s(Error("PDF generator unavailable."))},a.onerror=()=>s(Error("Failed to load PDF generator.")),document.body.appendChild(a)})},ee=async()=>{if(!f&&v){L(null),_(!0);try{let e=await $();if(!e)throw Error("PDF generator unavailable.");let t=new e({unit:"pt",format:"a4"}),s=t.internal.pageSize.getWidth(),a=t.internal.pageSize.getHeight(),r=s-96,n=(null==o?void 0:o.name)||(null==o?void 0:o.email)||"Advotac User",l=new Date().toLocaleString(),i=48,c=e=>{i+e>a-48&&(t.addPage(),i=48)};if(t.setFont("helvetica","bold"),t.setFontSize(18),t.text("Advotac Analysis Report",48,i),i+=28,t.setFont("helvetica","normal"),t.setFontSize(12),t.text("Name of User: ".concat(n),48,i),i+=18,t.text("Generated At: ".concat(l),48,i),i+=24,t.text("Source: ".concat(v.source),48,i),i+=24,t.setFont("helvetica","bold"),t.setFontSize(14),t.setTextColor(14,133,135),t.text("Summary",48,i),i+=18,t.setFont("helvetica","normal"),t.setFontSize(12),t.setTextColor(0,0,0),t.splitTextToSize(v.summary,r).forEach(e=>{c(16),t.text(e,48,i),i+=16}),i+=12,t.setFont("helvetica","bold"),t.setFontSize(14),t.setTextColor(14,133,135),t.text("Detailed Analysis",48,i),i+=18,t.setFont("helvetica","normal"),t.setFontSize(12),t.setTextColor(0,0,0),t.splitTextToSize(v.analysis,r).forEach(e=>{c(16),t.text(e,48,i),i+=16}),i+=12,v.key_points.length>0&&(t.setFont("helvetica","bold"),t.setFontSize(14),t.setTextColor(14,133,135),t.text("Key Points",48,i),i+=18,t.setFont("helvetica","normal"),t.setFontSize(12),t.setTextColor(0,0,0),v.key_points.forEach((e,s)=>{c(16);let a="".concat(s+1,". ").concat(e);t.text(t.splitTextToSize(a,r),48,i),i+=16}),i+=12),v.keywords.length>0){t.setFont("helvetica","bold"),t.setFontSize(14),t.setTextColor(14,133,135),t.text("Keywords",48,i),i+=18,t.setFont("helvetica","normal"),t.setFontSize(12),t.setTextColor(0,0,0);let e=v.keywords.join(", ");t.splitTextToSize(e,r).forEach(e=>{c(16),t.text(e,48,i),i+=16}),i+=12}v.comparisons.length>0&&(t.setFont("helvetica","bold"),t.setFontSize(14),t.setTextColor(14,133,135),t.text("Comparative Insights",48,i),i+=18,t.setFont("helvetica","normal"),t.setFontSize(12),t.setTextColor(0,0,0),v.comparisons.forEach((e,s)=>{c(16),t.text(t.splitTextToSize("".concat(s+1,". ").concat(e),r),48,i),i+=16}),i+=12),v.table_markdown&&(t.setFont("helvetica","bold"),t.setFontSize(14),t.setTextColor(14,133,135),t.text("Structured Comparison (Markdown)",48,i),i+=18,t.setFont("helvetica","normal"),t.setFontSize(11),t.setTextColor(0,0,0),t.splitTextToSize(v.table_markdown,r).forEach(e=>{c(16),t.text(e,48,i),i+=16}),i+=12),t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor(14,133,135),t.text("Metadata",48,i),i+=16,t.setFont("helvetica","normal"),t.setFontSize(11),t.setTextColor(0,0,0),["Original Query: ".concat(v.query),"Input Characters: ".concat(v.input_characters),v.truncated?"Note: Input was truncated to fit the token budget.":null].filter(Boolean).forEach(e=>{c(16),t.text(t.splitTextToSize(e,r),48,i),i+=16});let d=t.getNumberOfPages();for(let e=1;e<=d;e+=1)t.setPage(e),t.setFont("helvetica","italic"),t.setFontSize(9),t.setTextColor(120,120,120),t.text("Generated by Advotac",48,a-24);t.save("advotac-analysis-".concat(v.token,".pdf"))}catch(e){console.error("[ASSISTANT RESULT] Analysis PDF generation failed:",e),L(e instanceof Error?e.message:"Unable to generate PDF. Please try again later.")}finally{_(!1)}return}if(0===H)return void L("Please add at least one answer to the result before generating a PDF.");if(!o)return void L("Please sign in to generate a PDF.");L(null),_(!0);try{let e=await $();if(!e)throw Error("PDF generator unavailable.");let t=new e({unit:"pt",format:"a4"}),s=t.internal.pageSize.getWidth(),a=t.internal.pageSize.getHeight(),r=s-96,n=o.name||o.email||"Advotac User",l=new Date().toLocaleString(),i=48,c=e=>{i+e>a-48&&(t.addPage(),i=48)};t.setFont("helvetica","bold"),t.setFontSize(18),t.text("Advotac Result Bundle",48,i),i+=28,t.setFont("helvetica","normal"),t.setFontSize(12),t.text("Name of User: ".concat(n),48,i),i+=18,t.text("Generated At: ".concat(l),48,i),i+=24,G.forEach((e,s)=>{let a=e.response.answer||"No answer available.";c(64),t.setFont("helvetica","bold"),t.setFontSize(14),t.setTextColor(14,133,135),t.text("Question ".concat(s+1),48,i),i+=18,t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor(0,0,0),t.splitTextToSize(e.question,r).forEach(e=>{c(16),t.text(e,48,i),i+=16}),c(32),t.setFont("helvetica","normal"),t.setFontSize(12),t.splitTextToSize(a,r).forEach(e=>{c(16),t.text(e,48,i),i+=16}),e.response.sources&&e.response.sources.length>0&&(c(32),t.setFont("helvetica","bold"),t.setFontSize(11),t.text("Sources:",48,i),i+=16,t.setFont("helvetica","normal"),t.setFontSize(10),e.response.sources.forEach((e,s)=>{let a=[e.layer?"Layer ".concat(e.layer):null,e.collection||null,e.doc_title||e.act_title||e.section_heading||e.heading||null].filter(Boolean).join(" • "),n=e.snippet?"Snippet: ".concat(e.snippet):null;t.splitTextToSize("".concat(s+1,". ").concat(a).concat(n?"\n".concat(n):""),r).forEach(e=>{c(16),t.text(e,60,i),i+=16}),i+=4})),i+=12}),c(40),t.setFont("helvetica","italic"),t.setFontSize(9),t.setTextColor(100,100,100);let d=t.getNumberOfPages();for(let e=1;e<=d;e+=1)t.setPage(e),t.setFont("helvetica","italic"),t.setFontSize(9),t.setTextColor(120,120,120),t.text("Generated by Advotac",48,a-24);t.save("advotac-results-".concat(Date.now(),".pdf"))}catch(e){console.error("[ASSISTANT RESULT] PDF generation failed:",e),L(e instanceof Error?e.message:"Unable to generate PDF. Please try again later.")}finally{_(!1)}},et=async()=>{if(!f&&v){L(null),C(!0);try{let e=(null==o?void 0:o.name)||(null==o?void 0:o.email)||"Advotac User",t=new Date().toLocaleString(),s=['<html><head><meta charset="utf-8" />',"<style>body{font-family:Arial, sans-serif;line-height:1.6;font-size:12pt;color:#111827;}h1{color:#0E8587;}h2{color:#0E8587;margin-top:24px;}p{margin:8px 0;}ul{margin:8px 0 8px 20px;}li{margin:4px 0;}strong{color:#0E8587;} .divider{margin:24px 0;border-top:1px solid #e5e7eb;} .meta{color:#374151;} .disclaimer{font-size:10px;color:#6b7280;margin-top:24px;} .pill{display:inline-block;margin:4px 8px 0 0;padding:4px 10px;border-radius:999px;background:#e6f7f8;color:#0E8587;font-size:11pt;font-weight:600;} pre{background:#f9fafb;padding:16px;border-radius:12px;overflow-x:auto;}</style>","</head><body>","<h1>Advotac Analysis Report</h1>",'<p class="meta"><strong>Name of User:</strong> '.concat(V(e),"</p>"),'<p class="meta"><strong>Generated At:</strong> '.concat(V(t),"</p>"),'<p class="meta"><strong>Source:</strong> '.concat(V(v.source),"</p>"),'<div class="divider"></div>',"<h2>Summary</h2>","<p>".concat(V(v.summary||"No summary available."),"</p>"),"<h2>Detailed Analysis</h2>","<p>".concat(V(v.analysis||"No detailed analysis available."),"</p>")];v.key_points.length>0&&(s.push("<h2>Key Points</h2>"),s.push("<ul>"),v.key_points.forEach(e=>{s.push("<li>".concat(V(e),"</li>"))}),s.push("</ul>")),v.keywords.length>0&&(s.push("<h2>Keywords</h2>"),s.push("<div>"),v.keywords.forEach(e=>{s.push('<span class="pill">'.concat(V(e),"</span>"))}),s.push("</div>")),v.comparisons.length>0&&(s.push("<h2>Comparative Insights</h2>"),s.push("<ul>"),v.comparisons.forEach(e=>{s.push("<li>".concat(V(e),"</li>"))}),s.push("</ul>")),v.table_markdown&&(s.push("<h2>Structured Comparison (Markdown)</h2>"),s.push("<pre>".concat(V(v.table_markdown),"</pre>"))),s.push("<h2>Metadata</h2>"),s.push("<ul>"),s.push("<li><strong>Original Query:</strong> ".concat(V(v.query),"</li>")),s.push("<li><strong>Input Characters:</strong> ".concat(v.input_characters,"</li>")),v.truncated&&s.push("<li><strong>Note:</strong> Input was truncated to fit the token budget.</li>"),s.push("</ul>"),s.push("</body></html>");let a=new Blob([s.join("")],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),r=URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download="advotac-analysis-".concat(v.token,".docx"),n.click(),URL.revokeObjectURL(r)}catch(e){console.error("[ASSISTANT RESULT] Analysis DOC generation failed:",e),L(e instanceof Error?e.message:"Unable to download document. Please try again later.")}finally{C(!1)}return}if(0===H)return void L("Please add at least one answer to the result before downloading a document.");L(null),C(!0);try{let e=(null==o?void 0:o.name)||(null==o?void 0:o.email)||"Advotac User",t=new Date().toLocaleString(),s=['<html><head><meta charset="utf-8" />',"<style>body{font-family:Arial, sans-serif;line-height:1.6;font-size:12pt;color:#111827;}h1{color:#0E8587;}h2{color:#0E8587;margin-top:24px;}p{margin:8px 0;}ul{margin:8px 0 8px 20px;}li{margin:4px 0;}strong{color:#0E8587;} .divider{margin:24px 0;border-top:1px solid #e5e7eb;} .meta{color:#374151;} .disclaimer{font-size:10px;color:#6b7280;margin-top:24px;}</style>","</head><body>","<h1>Advotac Result Bundle</h1>",'<p class="meta"><strong>Name of User:</strong> '.concat(V(e),"</p>"),'<p class="meta"><strong>Generated At:</strong> '.concat(V(t),"</p>")];G.forEach((e,t)=>{s.push('<div class="divider"></div>'),s.push("<h2>Question ".concat(t+1,"</h2>")),s.push("<p><strong>Prompt:</strong> ".concat(V(e.question),"</p>")),s.push("<p><strong>Answer:</strong></p>");let a=(e.response.answer||"No answer available.").split(/\n+/).map(e=>e.trim()).filter(e=>e.length>0);0===a.length?s.push("<p>No answer available.</p>"):a.forEach(e=>{s.push("<p>".concat(V(e),"</p>"))}),e.response.sources&&e.response.sources.length>0&&(s.push("<p><strong>Sources:</strong></p>"),s.push("<ul>"),e.response.sources.forEach((e,t)=>{let a=[e.layer?"Layer ".concat(e.layer):null,e.collection||null,e.doc_title||e.act_title||e.section_heading||e.heading||null].filter(Boolean).join(" • "),r=a?"".concat(t+1,". ").concat(a):"".concat(t+1,". Source"),n=e.snippet?"<br/><em>Snippet:</em> ".concat(V(e.snippet)):"";s.push("<li>".concat(V(r)).concat(n,"</li>"))}),s.push("</ul>")),e.response.validation&&(s.push("<p><strong>Validation:</strong></p>"),s.push("<p>".concat(V(e.response.validation),"</p>")))}),s.push("</body></html>");let a=new Blob([s.join("")],{type:"application/msword"}),r=URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download="advotac-results-".concat(Date.now(),".doc"),n.click(),URL.revokeObjectURL(r)}catch(e){console.error("[ASSISTANT RESULT] DOC generation failed:",e),L(e instanceof Error?e.message:"Unable to download document. Please try again later.")}finally{C(!1)}},es=async(e,t,s,a)=>{if(!f||!o)return;let r=f.task||"General";try{await fetch("".concat(c,"/api/assistant/general-history"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,parent_token:f.token,task_name:"".concat(r," Follow-up"),query:t,response:s,user_id:o.id||o.email,user_email:o.email,created_at:a})})}catch(e){console.warn("[ASSISTANT RESULT] Failed to persist follow-up history:",e)}},ea=(e,t,s)=>{var a;let n=e?((e,t)=>{var s;let a=[],r=(null==t?void 0:t.trim())||"this topic",n=e=>{let t=null==e?void 0:e.trim();t&&(a.some(e=>e.toLowerCase()===t.toLowerCase())||a.push(t))};return null==e||null==(s=e.expanded_queries)||s.forEach(e=>n(e)),a.length<4&&i.forEach(e=>{a.length>=4||n(e(r))}),a.slice(0,4)})(e,t):[],l=s.isPrimary?"general-result":"general-result general-follow-up",o=!!(e&&!s.isLoading&&!s.errorMessage),c=T||F,d=null!=(a=P[s.id])?a:{value:"",error:null};return(0,r.jsxs)("div",{className:l,children:[(0,r.jsxs)("div",{className:"general-section",children:[(0,r.jsx)("h3",{children:"Prompt"}),(0,r.jsx)("p",{className:"general-query",children:t})]}),(0,r.jsxs)("div",{className:"general-section",children:[(0,r.jsx)("h3",{children:"Answer"}),(0,r.jsx)("div",{className:"general-answer",children:s.isLoading?(0,r.jsx)("div",{className:"follow-up-loading",children:"Generating follow-up answer..."}):s.errorMessage?(0,r.jsx)("div",{className:"assistant-error",children:s.errorMessage}):e?(0,r.jsx)(u,{answer:e.answer}):(0,r.jsx)("div",{className:"follow-up-loading",children:"No answer available yet."})})]}),(0,r.jsxs)("div",{className:"general-section answer-actions",children:[(0,r.jsxs)("div",{className:"answer-actions-row",children:[(0,r.jsx)("button",{type:"button",className:"answer-action-button ".concat(s.isSelected?"selected":""),onClick:s.onToggleSelection,disabled:!o||c,children:s.isSelected?"Remove from Result":"Add to Result"}),(0,r.jsx)("button",{type:"button",className:"answer-action-button primary",onClick:ee,disabled:c||0===H,children:T?"Generating PDF...":"Generate PDF"}),(0,r.jsx)("button",{type:"button",className:"answer-action-button primary secondary",onClick:et,disabled:c||0===H,children:F?"Preparing Doc...":"Download Doc"})]}),(0,r.jsx)("p",{className:"answer-actions-hint",children:H>0?"".concat(H," answer").concat(H>1?"s":""," selected for export."):"Select at least one answer to include it in the export."}),s.isPrimary&&E&&(0,r.jsx)("div",{className:"assistant-error pdf-error",children:E})]}),e&&n.length>0&&(0,r.jsxs)("div",{className:"general-section general-suggestions",children:[(0,r.jsx)("h3",{children:"Suggested Follow-up Questions"}),(0,r.jsx)("p",{className:"general-suggestions-hint",children:"Select a question to generate a fresh response."}),(0,r.jsx)("div",{className:"suggestion-buttons",children:n.map(e=>{let t=S.some(t=>t.query.toLowerCase()===e.toLowerCase()&&t.isLoading),a=t||!!s.isLoading||B||c;return(0,r.jsx)("button",{className:"suggestion-button",onClick:()=>void Q(e),disabled:a,type:"button",children:t?"Generating...":a?"Please wait...":e},"".concat(s.id,"-suggestion-").concat(e))})})]}),e&&(0,r.jsxs)("div",{className:"general-section general-custom-question",children:[(0,r.jsx)("h3",{children:"Ask Your Own Follow-up"}),(0,r.jsx)("p",{className:"general-suggestions-hint",children:"Keep the question focused on this matter and we'll respond in the same structured format."}),(0,r.jsxs)("form",{className:"custom-question-form",onSubmit:e=>((e,t,s)=>{var a,r;e.preventDefault();let n=null!=(r=null==(a=P[t])?void 0:a.value)?r:"",l=n.trim();return l?f?K(l,s)?void(q(e=>({...e,[t]:{value:"",error:null}})),Q(l)):void q(e=>({...e,[t]:{value:n,error:"Please keep your follow-up related to the original request."}})):void q(e=>({...e,[t]:{value:n,error:"Follow-up questions are only available for saved task results."}})):void q(e=>({...e,[t]:{value:n,error:"Please enter a follow-up question."}}))})(e,s.id,t),children:[(0,r.jsx)("textarea",{className:"custom-question-textarea",placeholder:"Type your follow-up question here...",value:d.value,onChange:e=>{let t=e.target.value;q(e=>({...e,[s.id]:{value:t,error:null}}))},rows:3,disabled:B||c}),d.error&&(0,r.jsx)("div",{className:"assistant-error custom-question-error",children:d.error}),(0,r.jsx)("div",{className:"custom-question-actions",children:(0,r.jsx)("button",{type:"submit",className:"suggestion-button custom-question-submit",disabled:B||c||!(d.value&&d.value.trim().length>0),children:B?"Please wait...":"Generate Follow-up Answer"})})]})]}),e&&e.sources.length>0&&(0,r.jsxs)("div",{className:"general-section",children:[(0,r.jsx)("h3",{children:"Sources"}),(0,r.jsx)("div",{className:"general-sources",children:e.sources.map((e,t)=>{var a,n,l;return(0,r.jsxs)("div",{className:"general-source-card",children:[(0,r.jsxs)("div",{className:"general-source-header",children:[e.layer&&(0,r.jsx)("span",{className:"general-source-badge",children:e.layer}),"number"==typeof e.score&&!Number.isNaN(e.score)&&(0,r.jsxs)("span",{className:"general-source-score",children:["Score ",(100*e.score).toFixed(1),"%"]})]}),e.collection&&(0,r.jsx)("p",{className:"general-source-collection",children:e.collection}),(e.doc_title||e.act_title||e.section_heading||e.heading)&&(0,r.jsx)("h4",{className:"general-source-title",children:null!=(l=null!=(n=null!=(a=e.doc_title)?a:e.act_title)?n:e.section_heading)?l:e.heading}),(e.section_number||e.context_path||e.breadcrumbs)&&(0,r.jsx)("p",{className:"general-source-meta",children:[e.section_number,e.context_path,e.breadcrumbs].filter(Boolean).join(" • ")}),e.snippet&&(0,r.jsx)("p",{className:"general-source-snippet",children:e.snippet})]},"".concat(s.id,"-source-").concat(t))})})]}),(null==e?void 0:e.validation)&&(0,r.jsxs)("div",{className:"general-section general-validation",children:[(0,r.jsx)("h3",{children:"Validation"}),(0,r.jsx)("p",{children:e.validation})]})]},s.id)};if(p)return(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:"#f7f9fc"},children:(0,r.jsx)("div",{style:{textAlign:"center"},children:(0,r.jsx)("div",{style:{fontSize:"24px",marginBottom:"16px",color:"#0E8587"},children:"Loading..."})})});let er=!!(f||v),en=null!=(t=null!=(e=null==f?void 0:f.task)?e:null==v?void 0:v.task)?t:"Analysis",el=f?"".concat(en," Task Complete"):v?"Analysis Complete":m?"Processing Your Request":"Result Unavailable",eo=f?"Your assistant finished processing the ".concat(en.toLowerCase()," request."):v?"Your assistant finished processing the request.":m?"Your assistant is analyzing your request...":null!=w?w:"Unable to load the requested result.",ei=f?new Date(f.created_at).toLocaleString():v?new Date(v.created_at).toLocaleString():"—",ec=(e=>{var t;if(!e)return[];let s=[],a=new Set,r=(null==(t=e.query)?void 0:t.trim())||"this matter",n=e=>{let t=null==e?void 0:e.trim();if(!t)return;let r=t.toLowerCase();a.has(r)||(a.add(r),s.push(t))};return e.keywords.slice(0,4).forEach(e=>{n("How does ".concat(e," apply under Indian law in this context?")),n("What statutory defences could counter ".concat(e,"?"))}),s.length<6&&(n('Which Indian precedents align with "'.concat(r,'"?')),n('What compliance steps arise from "'.concat(r,'" under Indian law?')),n('Identify emerging risks related to "'.concat(r,'" in India.')),n('What remedies are available in India for disputes similar to "'.concat(r,'"?')),n('How would courts balance equities in "'.concat(r,'" situations?')),n('Does "'.concat(r,'" trigger procedural obligations under the CrPC or CPC?'))),s.slice(0,6)})(v);return(0,r.jsxs)("div",{className:"dashboard-container",children:[(0,r.jsxs)("aside",{className:"sidebar",children:[(0,r.jsx)("div",{className:"sidebar-header",children:(0,r.jsxs)("div",{className:"logo",children:[(0,r.jsx)("img",{src:"/advotac_logo.png",alt:"Advotac Logo",className:"logo-image"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{children:"Advotac"}),(0,r.jsx)("p",{children:"Legal AI Workspace"})]})]})}),(0,r.jsxs)("nav",{className:"sidebar-nav",children:[(0,r.jsxs)("a",{href:"/dashboard",className:"nav-item",children:[(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})}),"Overview"]}),(0,r.jsxs)("a",{href:"/assistant",className:"nav-item active",children:[(0,r.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,r.jsx)("path",{d:"M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"}),(0,r.jsx)("path",{d:"M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"})]}),"Assistant"]}),(0,r.jsxs)("a",{href:"/research",className:"nav-item",children:[(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{d:"M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"})}),"Research"]}),(0,r.jsxs)("a",{href:"/drafting",className:"nav-item",children:[(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})}),"Drafting"]}),(0,r.jsxs)("a",{href:"/workflow",className:"nav-item",children:[(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),"Workflow"]}),(0,r.jsxs)("a",{href:"/history",className:"nav-item",children:[(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),"History"]})]}),(0,r.jsxs)("div",{className:"sidebar-footer",children:[(0,r.jsxs)("a",{href:"/settings",className:"nav-item",children:[(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})}),"Settings"]}),(0,r.jsxs)("button",{onClick:()=>{localStorage.clear(),window.location.replace("/auth")},className:"nav-item logout-btn",children:[(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z",clipRule:"evenodd"})}),"Logout"]})]})]}),(0,r.jsxs)("main",{className:"main-content",children:[(0,r.jsx)("header",{className:"dashboard-header",children:(0,r.jsxs)("div",{className:"header-left",children:[(0,r.jsx)("button",{className:"back-button",onClick:()=>s.push("/assistant"),title:"Go back",children:(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,r.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{children:"Assistant Result"}),(0,r.jsxs)("span",{className:"output-type-badge",children:[(0,r.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("path",{d:"M3 7h18"}),(0,r.jsx)("path",{d:"M3 12h18"}),(0,r.jsx)("path",{d:"M3 17h18"})]}),en]})]})]})}),(0,r.jsx)("div",{className:"result-content",children:(0,r.jsxs)("div",{className:"result-wrapper",children:[(0,r.jsxs)("section",{className:"result-status",children:[(0,r.jsx)("div",{className:er?"status-icon success":"status-icon processing",children:er?(0,r.jsx)("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,r.jsx)("polyline",{points:"20 6 9 17 4 12"})}):(0,r.jsxs)("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,r.jsx)("path",{d:"M12 6v6l4 2"})]})}),(0,r.jsxs)("div",{className:"status-content",children:[(0,r.jsx)("h2",{children:el}),(0,r.jsx)("p",{children:eo}),!er&&w&&(0,r.jsx)("div",{className:"assistant-error",style:{marginTop:"12px"},children:w}),!er&&(0,r.jsx)("button",{className:"retry-button",onClick:()=>{if(a.startsWith("gen-"))return void s.push("/assistant");x(!0),b(null),sessionStorage.removeItem("latestAnalysis"),window.location.reload()},children:a.startsWith("gen-")?"Start New Request":"Retry Fetch"})]})]}),(0,r.jsxs)("section",{className:"info-cards",children:[(0,r.jsxs)("div",{className:"info-card",children:[(0,r.jsx)("div",{className:"info-icon",children:(0,r.jsx)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,r.jsx)("path",{d:"M12 2l1.09 3.36L16 6l-2.5 1.82L14 11l-2-1.45L10 11l.5-3.18L8 6l2.91-.64L12 2z"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"Status"}),(0,r.jsx)("p",{children:er?"Completed":m?"Processing":"Unavailable"}),(0,r.jsx)("small",{children:"Latest update"})]})]}),(0,r.jsxs)("div",{className:"info-card",children:[(0,r.jsx)("div",{className:"info-icon",children:(0,r.jsx)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,r.jsx)("path",{d:"M3 5h18M3 12h18M3 19h18"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"Task"}),(0,r.jsx)("p",{children:en}),(0,r.jsx)("small",{children:"Requested action"})]})]}),(0,r.jsxs)("div",{className:"info-card",children:[(0,r.jsx)("div",{className:"info-icon",children:(0,r.jsxs)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("path",{d:"M12 8v4l3 3"}),(0,r.jsx)("circle",{cx:"12",cy:"12",r:"10"})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"Created"}),(0,r.jsx)("p",{children:ei}),(0,r.jsx)("small",{children:"Submission time"})]})]})]}),(0,r.jsxs)("section",{className:"result-preview",children:[(0,r.jsxs)("div",{className:"preview-header",children:[(0,r.jsx)("h2",{children:f?"".concat(en," Output"):"Analysis Output"}),er&&(0,r.jsxs)("div",{className:"preview-actions",children:[(0,r.jsxs)("button",{onClick:X,children:[(0,r.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),(0,r.jsx)("path",{d:"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"})]}),"Copy"]}),f?(0,r.jsxs)("button",{onClick:()=>{if(f){let e=(f.task||"General").toLowerCase().replace(/[^a-z0-9]+/g,"-"),t=new Blob([f.response.answer],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="advotac-".concat(e,"-").concat(f.token,".txt"),a.click(),URL.revokeObjectURL(s);return}},children:[(0,r.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),(0,r.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,r.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Download"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:()=>void ee(),disabled:T,children:[(0,r.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),(0,r.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,r.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),T?"Preparing PDF...":"Download PDF"]}),(0,r.jsxs)("button",{onClick:()=>void et(),disabled:F,children:[(0,r.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),(0,r.jsx)("polyline",{points:"14 2 14 8 20 8"})]}),F?"Preparing Docx...":"Download Docx"]})]})]})]}),f?(0,r.jsxs)(r.Fragment,{children:[ea(f.response,f.query,{id:f.token,isPrimary:!0,isSelected:!!k[f.token],onToggleSelection:()=>Z(f.token,f.query,f.response)}),S.length>0&&(0,r.jsx)("div",{className:"follow-up-list",children:S.map(e=>{var t;return ea(e.response,e.query,{id:e.id,isPrimary:!1,isLoading:e.isLoading,errorMessage:null!=(t=e.error)?t:null,isSelected:!!k[e.id],onToggleSelection:()=>Z(e.id,e.query,e.response)})})})]}):(0,r.jsx)("div",{className:"result-box",children:v?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"general-section general-result",children:[(0,r.jsx)("h3",{children:"Summary"}),(0,r.jsx)("p",{children:v.summary||"No summary available."}),(0,r.jsxs)("div",{className:"general-section general-analysis",children:[(0,r.jsx)("h3",{children:"Detailed Analysis"}),(0,r.jsx)("p",{children:v.analysis||"No detailed analysis available."})]}),v.key_points.length>0&&(0,r.jsxs)("div",{className:"general-section general-suggestions",children:[(0,r.jsx)("h3",{children:"Key Points"}),(0,r.jsx)("ul",{className:"general-analysis-points",children:v.key_points.map((e,t)=>(0,r.jsx)("li",{children:e},"".concat(v.token,"-point-").concat(t)))})]}),v.keywords.length>0&&(0,r.jsxs)("div",{className:"general-section general-keywords",children:[(0,r.jsx)("h3",{children:"Keywords"}),(0,r.jsx)("div",{className:"general-analysis-keywords",children:v.keywords.map((e,t)=>(0,r.jsx)("span",{className:"general-keyword-pill",children:e},"".concat(v.token,"-keyword-").concat(t)))})]}),v.comparisons.length>0&&(0,r.jsxs)("div",{className:"general-section general-comparisons",children:[(0,r.jsx)("h3",{children:"Comparative Insights"}),(0,r.jsx)("ul",{className:"general-analysis-points",children:v.comparisons.map((e,t)=>(0,r.jsx)("li",{children:e},"".concat(v.token,"-comparison-").concat(t)))})]}),v.table_markdown&&(0,r.jsxs)("div",{className:"general-section general-table",children:[(0,r.jsx)("h3",{children:"Structured Comparison"}),(0,r.jsx)("pre",{className:"general-analysis-table",children:v.table_markdown})]}),ec.length>0&&(0,r.jsxs)("div",{className:"general-section general-suggestions",children:[(0,r.jsx)("h3",{children:"Suggested Follow-up Questions"}),(0,r.jsx)("p",{className:"general-suggestions-hint",children:"Select a question to run it through the RAG pipeline."}),(0,r.jsx)("div",{className:"suggestion-buttons",children:ec.map(e=>{let t=z.some(t=>t.query.toLowerCase()===e.toLowerCase()&&t.isLoading),s=t||W||T||F;return(0,r.jsx)("button",{className:"suggestion-button",onClick:()=>{Y(e)},disabled:s,type:"button",children:t?"Generating...":s?"Please wait...":e},"analysis-suggestion-".concat(e))})})]}),(0,r.jsxs)("div",{className:"general-section general-custom-question",children:[(0,r.jsx)("h3",{children:"Ask Your Own Follow-up"}),(0,r.jsx)("p",{className:"general-suggestions-hint",children:"Keep the question focused on this matter and we'll respond with sources using RAG."}),(0,r.jsxs)("form",{className:"custom-question-form",onSubmit:e=>{if(e.preventDefault(),!v)return void O("Analysis result is unavailable. Please reload the task.");let t=D.trim();return t?K(t,v.query)?void(R(""),O(null),Y(t)):void O("Please keep your follow-up related to the original analysis."):void O("Please enter a follow-up question.")},children:[(0,r.jsx)("textarea",{className:"custom-question-textarea",placeholder:"Type your follow-up question here...",value:D,onChange:e=>{R(e.target.value),O(null)},rows:3,disabled:W||T||F}),I&&(0,r.jsx)("div",{className:"assistant-error custom-question-error",children:I}),(0,r.jsx)("div",{className:"custom-question-actions",children:(0,r.jsx)("button",{type:"submit",className:"suggestion-button custom-question-submit",disabled:W||T||F||!(D&&D.trim().length>0),children:W?"Please wait...":"Generate Follow-up Answer"})})]})]}),(0,r.jsxs)("div",{className:"general-section general-meta",children:[(0,r.jsx)("h3",{children:"Analysis Details"}),(0,r.jsxs)("ul",{className:"general-analysis-meta",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Original Query:"})," ",v.query]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Source:"})," ",v.source]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Input Characters:"})," ",v.input_characters]}),v.truncated&&(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Note:"})," Input was truncated to fit the token budget."]})]})]})]}),z.length>0&&(0,r.jsx)("div",{className:"follow-up-list",children:z.map(e=>(e=>{let t=e.response;return(0,r.jsxs)("div",{className:"general-result general-follow-up",children:[(0,r.jsxs)("div",{className:"general-section",children:[(0,r.jsx)("h3",{children:"Follow-up Question"}),(0,r.jsx)("p",{className:"general-query",children:e.query})]}),(0,r.jsxs)("div",{className:"general-section",children:[(0,r.jsx)("h3",{children:"Answer"}),(0,r.jsx)("div",{className:"general-answer",children:e.isLoading?(0,r.jsx)("div",{className:"follow-up-loading",children:"Generating follow-up answer..."}):e.error?(0,r.jsx)("div",{className:"assistant-error",children:e.error}):t?(0,r.jsx)(u,{answer:t.answer}):(0,r.jsx)("div",{className:"follow-up-loading",children:"No answer available yet."})})]}),(null==t?void 0:t.sources)&&t.sources.length>0&&(0,r.jsxs)("div",{className:"general-section",children:[(0,r.jsx)("h3",{children:"Sources"}),(0,r.jsx)("div",{className:"general-sources",children:t.sources.map((t,s)=>{var a,n,l;return(0,r.jsxs)("div",{className:"general-source-card",children:[(0,r.jsxs)("div",{className:"general-source-header",children:[t.layer&&(0,r.jsx)("span",{className:"general-source-badge",children:t.layer}),"number"==typeof t.score&&!Number.isNaN(t.score)&&(0,r.jsxs)("span",{className:"general-source-score",children:["Score ",(100*t.score).toFixed(1),"%"]})]}),t.collection&&(0,r.jsx)("p",{className:"general-source-collection",children:t.collection}),(t.doc_title||t.act_title||t.section_heading||t.heading)&&(0,r.jsx)("h4",{className:"general-source-title",children:null!=(l=null!=(n=null!=(a=t.doc_title)?a:t.act_title)?n:t.section_heading)?l:t.heading}),(t.section_number||t.context_path||t.breadcrumbs)&&(0,r.jsx)("p",{className:"general-source-meta",children:[t.section_number,t.context_path,t.breadcrumbs].filter(Boolean).join(" • ")}),t.snippet&&(0,r.jsx)("p",{className:"general-source-snippet",children:t.snippet})]},"".concat(e.id,"-source-").concat(s))})})]}),(null==t?void 0:t.validation)&&(0,r.jsxs)("div",{className:"general-section general-validation",children:[(0,r.jsx)("h3",{children:"Validation"}),(0,r.jsx)("p",{children:t.validation})]})]},e.id)})(e))})]}):m?(0,r.jsx)("div",{className:"loading-placeholder",children:"Waiting for analysis result..."}):(0,r.jsx)("div",{className:"loading-placeholder",children:"Unable to load analysis result. Please retry or contact support."})})]})]})})]})]})}},8151:()=>{}}]);